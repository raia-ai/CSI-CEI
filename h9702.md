# EFP Technical Reference
* * *
# General Rules
Case is ignored in equations and functions. White space is also ignored. Constants should consist of a mantissa, optionally followed by an exponent. The mantissa must have at least 1 digit. The exponent comprises E, optionally followed by a sign, followed by at least 1 digit. There can be no decimal point in the exponent. The following are examples of valid constants:
**69.28 312. 73.5E6 9E-4**
## Equation Syntax
Equations shall be of the following form:
_variable\[\(expr\)\] = expr_
Where **expr** is an expression - see Expression Syntax and **variable** is one of the following _integer_ types:
**EQN** | the number of the next equation to be evaluated.  
---|---  
**I**\[\(expr\)\] | a local variable normally used as a subscript variable.  
**T**\[\(expr\)\] | the length of a table used in a calculation.  
**U** | Units variable 0 = US, 1 = SI.  
or one of the following _real_ types:
**PI** | the value of π  
---|---  
**E**\[\(expr\)\] | environment variables used to pass data to and from other Engineering Modules.  
**F**\[\(expr\)\] | numeric fields containing input or output values.  
**G**\[\(expr\)\] | global variables used to pass data in chained calculations.  
**L**\[\(expr\)\] | local variables used for intermediate calculations which are not output.  
A full description of each variable type is given in section EFP Variable.
Equations are terminated by the end of the line, or optionally by a semi-colon \(;\), or a colon \(:\).
Text appearing after a semi-colon is ignored. This may be used for comments in the program. Text appearing after a colon is echoed to the screen when the equation is evaluated and may be used in conjunction with the _KBD\(\)_ function - see section KBD.
## Function Syntax
_function\_name\(dummy\_1\[,dummy\_2,dummy\_3 ...\]\) = expr_
Where _function\_name_ is less then ten characters in length and must not conflict with any of the in-built variable or function names, nor with dummy argument names in the equations where it is accessed. Function names must begin with a letter, followed by alphanumeric characters. As with equations case is ignored.
_dummy\_1_ , _dummy\_2_ , _dummy\_3_ ... are dummy arguments which must not conflict with any variable or function names. Dummy argument names must begin with a letter, followed by alphanumeric characters.
## Expression Syntax
An expression may be a constant, a variable or a function, or it may combine constants, variables and functions using operators.
Operators perform mathematical operations on values. There are two types of operations - _Unary_ and _Binary_ :
**Unary operations** consist of an operator followed by a constant, variable, function or expression.
\+ null operation: not normally used
\- negation: changes the sign of the value
For example:
**-3.729**
**-F\(4\)**
**-\(6.45\*L\(7\)\)**
**Binary operations** consist of two terms connected by an operator. Each term may be a constant, variable, function or expression.
^ exponentiation
\* multiplication
/ division
\- subtraction
\+ addition
The above list is organised in decreasing order of precedence for numeric operation. Therefore ^ has the highest priority and + the lowest. No two operators have the same priority.
NOTE : the EFP module differs from programming languages such as Fortran and Basic in that multiplication and division do not have the same order of precedence. For example, the expression 6/5\*2 would be evaluated as 0.6 using EFP and as 2.4 using Fortran or Basic.
The order in which operations are performed may be changed by the use of parentheses \(\). Operations within parentheses are performed first. Inside parentheses the order of precedence shown above is maintained. Where multiple parentheses are used the operations within the innermost parentheses are performed first. The limit on nested expressions is 15.
**Range checking** of subscripted variables is handled as follows. In the following example program
F\(-9\) = 0
F\(I\) = 0
The first line would be recognised as an error, the second line would only be recognised as an error if **I** was negative or exceeded the EFP's internal memory limits. Therefore, care should be taken to ensure that the program cannot generate out of range subscripts.
## EFP Variables
NOTE : Variables are not range checked by the program. For example, if environment variable E\(109\) was assigned a value, then the value would in fact be assigned to G\(35\).
**_EQN_**
The EQN variable contains the number of the next equation to be executed. Conditional reassignment of the EQN variable enables branching within the program. For example:
EQN=IF\(L-8,EQN,EQN+1\)
L = SQR\(L\)
F\(1\) = L
This would result in the square root of **L** being calculated if **L** was greater than 8 - see the description of the IF function for further details.
**_E\(20\) to E\(75\)_**
These are the standard Finglow Software environment variables and are used to communicate values to and from the other Engineering Modules.
**E\(20\)** | Max Pressure  
---|---  
**E\(21\)** | Static head  
**E\(22\)** | Liquid SG  
**E\(23\)** | Design pressure  
**E\(24\)** | Design temperature  
**E\(25\)** | Internal corrosion allowance  
**E\(26\)** | Allowable stress ATM  
**E\(27\)** | Allowable stress DT  
**E\(30\)** | Thinning allowance \(shell\): absolute  
**E\(31\)** | Material SG  
**E\(32\)** | Large end OD  
**E\(33\)** | Large end ID  
**E\(34\)** | Small end OD  
**E\(35\)** | Small end ID  
**E\(36\)** | Inside spherical radius  
**E\(37\)** | Inside knuckle radius  
**E\(38\)** | Inside head height  
**E\(39\)** | Outside head height  
**E\(40\)** | Length tan to tan  
**E\(41\)** | Half apex angle  
**E\(42\)** | Large end new shell thk  
**E\(43\)** | New thk \(head\)  
**E\(44\)** | Large end new cone thk  
**E\(45\)** | Small end new cone thk  
**E\(46\)** | Elastic modulus DT  
**E\(50\)** | Small end location  
**E\(51\)** | Large end location  
**E\(52\)** | External design pressure  
**E\(53\)** | Large end stiffener area  
**E\(54\)** | Small end stiffener area  
**E\(55\)** | Allowable stiffener stress  
**E\(56\)** | Flange width  
**E\(57\)** | Flange thk  
**E\(58\)** | Web thk  
**E\(59\)** | Web height  
**E\(60\)** | Flange width: lower  
**E\(61\)** | Flange thk : lower  
**E\(62\)** | Yield factor s  
**E\(65\)** | Min tensile strength  
**E\(66\)** | Applied bending moment  
**E\(67\)** | Applied axial comp force  
**E\(68\)** | Small end new shell thk  
**E\(69\)** | External corrosion allowance  
**E\(70\)** | Large end knuckle rad  
**E\(71\)** | Small end knuckle rad  
**E\(72\)** | Applied axial tensile force  
**E\(73\)** | Thinning allowance \(shell\): percent  
**_F\(1\) to F\(240\)_**
Field variables reference the contents of _Input Fields_ and _Output Fields_. Fields are numbered sequentially on the Data Sheet, with **F\(1\)** being the top and leftmost of all fields.
NOTE : _Alpha Fields_ are not allocated a number.
Field variables may be manipulated and assigned in the same manner as Local and Global variables.
Fields are referenced by their position-dependent subscript, i.e. F\(1\), F\(2\), F\(3\), etc. Input and output fields may be mixed on the Data Sheet in any combination, the field number being determined by position only. The method of calculation imposes no restriction on the sequencing of input and output fields, therefore the most convenient screen layout may be employed. For example the following screen layout for the calculation of **beta** :
would be handled by the one line equation:
F\(2\) = F\(1\) / F\(3\)
**_G\(0\) to G\(240\)_**
Global variables are employed where it is required to share data between a series of 2 or more related Equation Files. Values are assigned to Global variables when the calculation is run. The main difference between Global and Local variables is that the Global variables are not initialised to zero when a sheet is loaded into memory. Due care must therefore be exercised to initialise Global variables correctly.
**_I\(0\) to I\(19\)_**
Integer variables provide a means of manipulating variable subscripts during Data Sheet execution.
Integer variables may be used anywhere within a sheet that a constant might be used. They may be used in any order and may be assigned and reassigned as required.
The values contained in Integer variables may subsequently be assigned to Global and numeric Field variables. They are usually used as an index to Field, Table, Global and other Local variables. For example:
I = LOOP\(1,8,1,1\)
F\(I\) = 0
would result in the fields F\(1\) to F\(8\) being set to zero.
**_L\(0\) to L\(240\)_**
Local variables provide a means of storing intermediate or temporary values during Data Sheet execution. Local variables may be used anywhere within a sheet that a constant might be used. They may be used in any order and may be assigned and reassigned as required. The values contained in Local variables may subsequently be assigned to Global and numeric Field variables. They are normally used to hold partial results of a calculation. For example:
L\(9\) = \(F\(1\)+F\(2\)\) \* F\(3\)
F\(1\) = L\(9\) + L\(9\)^2 + L\(9\)^3
**_PI_**
The PI variable contains the value of π expressed as **4\*arctan\(1\)** , thus giving maximum machine precision. In common with other EFP variables PI may be reassigned within the context of the program to meet the needs of individual applications \(such as PI = 22/7\). However, reassignment is a local operation only and the reassigned value will be lost when other Data Sheets are subsequently loaded.
**_T\(1\) to T\(10\)_**
Table variables are employed to indicate the length of each table used in the Data Sheet. For a discussion of Table fields - see section [Creating Tables](<h9703.htm#0400>).
Table variables are numbered T\(1\), T\(2\), T\(3\), referring to the 1st, 2nd, 3rd, etc. tables found in the sheet. The length of each table is expressed in terms of the number of contiguous physical lines on the screen occupied by the table and this value will be automatically assigned to the appropriate T\(expr\) variable when the Calculate option is selected. The Table variable provides a convenient means of handling variable length tables within a program.
WARNING : Do not reassign Table variables in a calculation.
The following example computes the sum of the fields comprising the second column \(shown in italics\) of a table that is four fields wide.
_Example data sheet_
| 1 | _12_ | 101 | 12.3 |   
---|---|---|---|---|---  
| 2 | _10_ | 99 | 12.4 |   
| 3 | _9_ | 56 | 12.6 |   
In this example the EFP module would set T\(1\) equal to three. If the first field in the table is assumed to be F\(1\), the fields to be summed are F\(2\), F\(6\) and F\(10\).
I = 4 \* T\(1\) + 1
F\(I\) = 0
F\(I\) = F\(I\) + F\(LOOP\(2,I,4,0\)\)
**I** will be calculated as 13 and 'points' to the field where the sum is to be stored. The LOOP function would yield the values 2, 6, 10.
**_U_**
The units variable is set by the last engineering module selected. The variable can be changed by resetting its value from the EFP module: to 0 for US or 1 for SI units. The following example converts the value in F\(1\) to either mm or inches depending on the value of U:
F\(2\) = F\(1\) \* 25.4 : Convert to mm
EQN=IF\(U,EQN+1,EQN\)
F\(2\) = F\(1\) / 25.4 : Convert to inch
## In-built EFP Functions
The following in-built functions are available for use in user defined calculations.
**_ABS_**
Syntax | : | ABS\(expr\)  
---|---|---  
Action | : | Returns the absolute value of the expression.  
**_ACS_**
Syntax | : | ACS\(expr\)  
---|---|---  
Action | : | Returns the arccosine of expr, where expr is in the range -1 to +1. Result is in the range 0 to p radians.  
**_ASN_**
Syntax | : | ASN\(expr\)  
---|---|---  
Action | : | Returns the arcsine of expr, where expr is in the range -1 to +1. Result is in the range -π/2 to +π/2 radians.  
**_ATN_**
Syntax | : | ATN\(expr\)  
---|---|---  
Action | : | Returns the arctangent of expr. Result is in the range -π/2 to +π/2 radians.  
**_ATN2_**
Syntax | : | ATN2\(expr\_1,expr\_2\)  
---|---|---  
Action | : | Returns the arctangent of \(expr\_2 divided by expr\_1\). Result is in the range -π to +π radians.  
**_COS_**
Syntax | : | COS\(expr\)  
---|---|---  
Action | : | Returns the cosine of expr, where expr is in radians.  
**_DAT_**
Syntax | : | DAT\(expr\_0,expr\_1\[,expr\_2,expr\_3,...\]\)  
---|---|---  
Action | : | Returns the parameter or data item \(expr\_1, expr\_2, expr\_3, etc.\) pointed to by expr\_0. For example if expr\_0 evaluated to 2 the result would be expr\_2. The number of data items is limited only by the length of the equation. The following example sets the local variables L\(5\) to L\(9\). Note that the assignment of the last variable L\(9\) has been made variable by use of the IF statement. I = LOOP\(1,5,1,1\) L\(I+4\)=DAT\(I, 2.34, 0.35, 4.6, 10.0, IF\(F\(1\),100,F\(9\)\)\)  
**_END_**
Syntax | : | END\(expr\)  
---|---|---  
Action | : | The END function will terminate the calculation, subsequent action is dependent on the value of expr. END\(0\) Early end - Go to the next page, if any. END\(1\) Fast end - abort. The following example demonstrates user intervention at the end of a calculation prior to running a linked calculation. I = IF\(KBD\(1\),0,1\) : continue to next sheet ? L = END\(I\)  
**_IF_**
Syntax | : | IF\(expr\_1,expr\_2,expr\_3\)  
---|---|---  
Action | : | If the value of expr\_1 is greater than zero then the IF function will return the value of expr\_2, otherwise the value of expr\_3 is returned. This function can be used for conditional branching within calculations when used in conjunction with the system variable EQN. For example: EQN=IF\(L-7,EQN,EQN+2\) will skip two lines if L is less than or equal to 7.  
**_INT_**
Syntax | : | INT\(expr\)  
---|---|---  
Action | : | The integer value of expr is returned. For example: F\(1\) = INT\(200/3\) would result in F\(1\) taking the value 66.  
**_KBD_**
Syntax | : | KBD\(expr\) | Action | : | Dependent on the value of expr the KBD function returns a value. Options are as follows:  
---|---|---  
|  | KBD\(0\) | Halts the calculation selecting **_Continue_** from the dialog box returns 1 and selecting **_Cancel_** returns 0.  
---|---|---|---  
|  | KBD\(1\) | Halts the calculation selecting **_Yes_** from the dialog box returns 1 and selecting **_No_** returns 0.  
|  | KBD\(-1\) | Is a special case used to toggle on and off the display to the screen of values returned from each subsequent equation. It should be used in conjunction with the KBD\(0\) option which has the effect of pausing the screen.  
|  | For example, to pause the screen after displaying the values returned from the first two equations below, the following might be employed:  
---|---|---  
|  | L = F\(10\)/F\(2\) + KBD\(-1\)  
|  | L\(1\) = F\(8\)\*L  
|  | L\(2\) = F\(9\)/L\(1\) + KBD\(0\)  
**_LOG_**
Syntax | : | LOG\(expr\)  
---|---|---  
Action | : | Returns the natural logarithm of expr  
**_LOG10_**
Syntax | : | LOG10\(expr\)  
---|---|---  
Action | : | Returns the logarithm to the base 10 of expr  
**_LOOP_**
Syntax | : | LOOP\(expr\_1,expr\_2,expr\_3,expr\_4\)  
---|---|---  
Action | : | Initiates a LOOP yielding integer values from expr\_1 to expr\_2 in increments of expr\_3, which may be negative. The number of lines, in addition to the current line, over which the loop extends is determined by expr\_4. The LOOP parameters are evaluated on the first pass of the loop only, hence any early exit must be performed using the EQN variable. On exit the loop is cancelled. LOOPS can be nested to maximum depth of 15 with the provision that no overlapping should occur and that there should not be more than one LOOP function call per equation. The following example sums the value of fields 1, 3, 6 & 9: L = 0 L = L + F\(LOOP\(1,9,3,0\)\) We recommend that all output fields be set zero; in the event that a calculation fails the previously calculated values would otherwise persist. The following example would set fields 10 through 20 to zero every time a calculation is run.  F\(LOOP\(10,20,1,0\)\) = 0   
**_MAX_**
Syntax | : | MAX\(expr\_1,expr\_2\[,expr\_3,expr\_4, ...\]\)  
---|---|---  
Action | : | Returns the maximum value from the list of expressions. The number of expressions is limited only by the width of the entry field. The following example finds the greatest value from the list L\(1\) to L\(3\). L = MAX\(L\(1\),L\(2\),L\(3\)\)  
**_MIN_**
Syntax | : | MIN\(expr\_1,expr\_2\[,expr\_3,expr\_4, ...\]\)  
---|---|---  
Action | : | Returns the minimum value from the list of expressions. The number of expressions is limited only by the width of the entry field. The following example finds the lowest value from the list L\(1\), L\(2\), L\(3\), any of which might be negative. L=MIN\(L\(1\),L\(2\),L\(3\)\)  
**_RND_**
Syntax | : | RND\(expr\_1,expr\_2\)  
---|---|---  
Action | : | Rounds expr\_1 to the nearest multiple of expression expr\_2. The algorithm used is integer\(expr\_1 / expr\_2 + 0.5\) \* expr\_2. The following example rounds the value of F\(3\) to the nearest multiple of 4 and rounds the value of local variable L\(2\) to 2 decimal places: F\(3\) = RND\(F\(3\),4\) L\(2\) = RND\(L\(2\),.01\)  
**_SIN_**
Syntax | : | SIN\(expr\)  
---|---|---  
Action | : | Returns the sine of expr, where expr is in radians.  
**_SQR_**
Syntax | : | SQR\(expr\)  
---|---|---  
Action | : | Returns the square root of expr.  
**_TAN_**
Syntax | : | TAN\(expr\)  
---|---|---  
Action | : | Returns the tangent of expr, where expr is in radians.  
## Run Time Error Messages
When an error is detected by the program one of the following messages will be displayed on the screen. Most messages will be preceded with _Equation X_ or _Function X_ , where _X_ refers to the equation or function number. Also at the end of each message there will be the text _S:snum/E:enum/F:fnum_. Where _S_ , _E_ and _F_ refer to the Screen, Equation and Function files and _snum_ , _enum_ and _fnum_ are the corresponding index numbers for those files and denote which files have been linked together to produce the input file selected.
Bad data pointer | The first expression in the DAT function is either a zero or points beyond the last expression.  
---|---  
Bad function argument name | A user defined function has been used without the correct number of parameters or an illegal name such as _T_ has been used  
Bad equation file | The equation file run has no equations in it.  
Bad function parameters | An in-built function has been used without the correct number of parameters.  
Bad keyboard code | The KBD\(\) function has been used with the wrong parameter, e.g. KBD\(2\).  
Bad key word | Symbol undefined.  
Bad nesting | The limit for nested functions is 15.  
Bad recursion | The recursion limit for user functions has been exceeded.  
Bad rounding operator | The RND\(\) function has been used with an invalid rounding operator, e.g. RND\(2.01,340\).  
Bad syntax | There is a syntax error in a function or equation. This message will also appear if there is a number greater than 9 digits in an equation.  
Can't Compute a Data Sheet | There is no equation file linked with this sheet.  
Corrupt screen file | The screen file has been corrupted in some way and should be deleted.  
Equation number out of range | The calculation has tried to access an equation that does not exist.  
Equations are too complex | The calculation has tried to access an equation that does not exist.  
Exceeded workspace | The calculation is too complex, the workspace limit has been exceeded.  
Function names too long | The system has space for 30 functions, each 10 characters in length.  
Integer number too big. | The inbuilt integer limit has been exceeded, e.g I\(100\).  
Math error\(type\) | A mathematical error has occurred in the calculation, where type is an indication of the sort of error. For example, division by zero would generate the type DIVIDE.  
No match found | A symbol or function could not be found.  
Too many equations | The equation file has too many equations, the limit is 100.  
Too many nested loops | The equation file has too many nested loops, the limit is 15.  
Too many user functions | The function file has too many user defined functions, the limit is 30.  
User function undefined | The function name cannot be found in the function file.  
Variable out of range | The subscript of a variable has exceeded the system limit - e.g. L\(242\) or L\(-1\).  
Variable number is too big | The subscript of a variable has exceeded the system limit - e.g. E\(3500\) or E\(-1\).  
Warning - message buffer overflow | There are too many long messages in the equation file.  
## System Error Messages
These messages will appear in either Edit Data or when editing or creating Screen, Equation and Function files.
Check : Corrupt File | A file has been corrupted in some way and should be deleted.  
---|---  
Field limit exceeded  | More than 240 fields have been created in one screen file.  
Field Overflow | A number is too big for the field width. This will result in the field being filled with hashes \(\#\) in the case of an output field. To allow for the sign of the number, the maximum allowed is one less than the field length.  
Input error: data modified | The screen file has been modified, e.g. added or deleted fields, so that the data in the input file no longer corresponds with the fields in the screen file. Some of the data may be corrupt.  
Check : Corrupt File | A file has been corrupted in some way and should be deleted.  
Invalid link list | _Create Link File_ has been selected without first using the _Link File_ option, or the selection is invalid.  
Table limit exceeded | More than 10 lines have been allocated as tables.  
Screen width exceeded | More than 77 characters on one line, the line will be truncated.  
Screen length exceeded | More than 60 lines in the screen file, the file will be truncated.  
Table's on consecutive lines | Two consecutive lines have the table attribute set, the program will turn the table attribute off for one on the lines  
* * *
©Finglow Research Ltd - 2024
